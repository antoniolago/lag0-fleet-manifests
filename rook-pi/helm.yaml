apiVersion: source.toolkit.fluxcd.io/v1
kind: HelmRepository
metadata:
  name: rook-ceph
  namespace: rook-ceph
spec:
  interval: 24h
  url: https://charts.rook.io/release
---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: rook
  namespace: rook-ceph
spec:
  releaseName: rook-release
  targetNamespace: rook-ceph
  install:
    createNamespace: true
  interval: 30m
  chart:
    spec:
      chart: rook-ceph
      sourceRef:
        kind: HelmRepository
        name: rook-ceph
        namespace: rook-ceph
      interval: 12h
  values:
    image:
      repository: docker.io/rook/ceph
      tag: master
      pullPolicy: IfNotPresent

    crds:
      enabled: true

    resources:
      limits:
        cpu: 2000m
        memory: 256Mi
        ephemeral-storage: 1Gi
      requests:
        cpu: 5m
        memory: 64Mi
        ephemeral-storage: 100Mi

    nodeSelector:
      kubernetes.io/arch: arm64

    tolerations:
      - key: "node.kubernetes.io/arm64"
        operator: "Exists"
        effect: "NoSchedule"

    currentNamespaceOnly: false

    logLevel: INFO

    rbacEnable: true

    rbacAggregate:
      enableOBCs: false

    pspEnable: false

    containerSecurityContext:
      runAsNonRoot: true
      runAsUser: 2016
      runAsGroup: 2016
      capabilities:
        drop: [ "ALL" ]

    allowLoopDevices: false

    csi:
      enableRbdDriver: false
      enableCephfsDriver: true
      disableCsiDriver: "false"
      enableCSIHostNetwork: false
      enableCephfsSnapshotter: false
      enableNFSSnapshotter: false
      enableRBDSnapshotter: false
      enablePluginSelinuxHostMount: false
      enableCSIEncryption: false
      enableVolumeGroupSnapshot: false
      rbdFSGroupPolicy: "File"
      cephFSFSGroupPolicy: "File"
      nfsFSGroupPolicy: "File"
      enableOMAPGenerator: false
      cephFSKernelMountOptions: ""
      enableMetadata: false
      provisionerReplicas: 1
      clusterName: "lag0-pi"
      csiRBDProvisionerResource: |
        - name : csi-provisioner
          resource:
            requests:
              memory: 64Mi
              cpu: 10m
              ephemeral-storage: 100Mi
            limits:
              memory: 256Mi
              cpu: 100m
              ephemeral-storage: 1Gi
        - name : csi-resizer
          resource:
            requests:
              memory: 64Mi
              cpu: 10m
              ephemeral-storage: 100Mi
            limits:
              memory: 256Mi
              cpu: 100m
              ephemeral-storage: 1Gi
        - name : csi-attacher
          resource:
            requests:
              memory: 64Mi
              cpu: 10m
              ephemeral-storage: 100Mi
            limits:
              memory: 256Mi
              cpu: 100m
              ephemeral-storage: 1Gi
        - name : csi-snapshotter
          resource:
            requests:
              memory: 64Mi
              cpu: 10m
              ephemeral-storage: 100Mi
            limits:
              memory: 256Mi
              cpu: 100m
              ephemeral-storage: 1Gi
        - name : csi-rbdplugin
          resource:
            requests:
              memory: 64Mi
              ephemeral-storage: 100Mi
            limits:
              memory: 1Gi
              cpu: 100m
              ephemeral-storage: 1Gi
        - name : csi-omap-generator
          resource:
            requests:
              memory: 64Mi
              cpu: 10m
              ephemeral-storage: 100Mi
            limits:
              memory: 1Gi
              cpu: 100m
              ephemeral-storage: 1Gi
        - name : liveness-prometheus
          resource:
            requests:
              memory: 64Mi
              cpu: 10m
              ephemeral-storage: 100Mi
            limits:
              memory: 256Mi
              cpu: 100m
              ephemeral-storage: 1Gi
      csiRBDPluginResource: |
        - name : driver-registrar
          resource:
            requests:
              memory: 64Mi
              cpu: 10m
              ephemeral-storage: 100Mi
            limits:
              memory: 256Mi
              cpu: 100m
              ephemeral-storage: 1Gi
        - name : csi-rbdplugin
          resource:
            requests:
              memory: 64Mi
              cpu: 10m
              ephemeral-storage: 100Mi
            limits:
              memory: 1Gi
              cpu: 100m
              ephemeral-storage: 1Gi
        - name : liveness-prometheus
          resource:
            requests:
              memory: 64Mi
              cpu: 10m
              ephemeral-storage: 100Mi
            limits:
              memory: 256Mi
              cpu: 100m
              ephemeral-storage: 1Gi
      csiCephFSProvisionerResource: |
        - name : csi-provisioner
          resource:
            requests:
              memory: 64Mi
              cpu: 10m
              ephemeral-storage: 100Mi
            limits:
              memory: 256Mi
              cpu: 100m
              ephemeral-storage: 1Gi
        - name : csi-resizer
          resource:
            requests:
              memory: 64Mi
              cpu: 10m
              ephemeral-storage: 100Mi
            limits:
              memory: 256Mi
              cpu: 100m
              ephemeral-storage: 1Gi
        - name : csi-attacher
          resource:
            requests:
              memory: 64Mi
              cpu: 10m
              ephemeral-storage: 100Mi
            limits:
              memory: 256Mi
              cpu: 100m
              ephemeral-storage: 1Gi
        - name : csi-snapshotter
          resource:
            requests:
              memory: 64Mi
              cpu: 10m
              ephemeral-storage: 100Mi
            limits:
              memory: 256Mi
              cpu: 100m
              ephemeral-storage: 1Gi
        - name : csi-cephfsplugin
          resource:
            requests:
              memory: 64Mi
              cpu: 10m
              ephemeral-storage: 100Mi
            limits:
              memory: 1Gi
              cpu: 100m
              ephemeral-storage: 1Gi
        - name : liveness-prometheus
          resource:
            requests:
              memory: 64Mi
              cpu: 10m
              ephemeral-storage: 100Mi
            limits:
              memory: 256Mi
              cpu: 100m
              ephemeral-storage: 1Gi
      csiCephFSPluginResource: |
        - name : driver-registrar
          resource:
            requests:
              memory: 64Mi
              cpu: 10m
              ephemeral-storage: 100Mi
            limits:
              memory: 256Mi
              cpu: 100m
              ephemeral-storage: 1Gi
        - name : csi-cephfsplugin
          resource:
            requests:
              memory: 64Mi
              cpu: 10m
              ephemeral-storage: 100Mi
            limits:
              memory: 1Gi
              cpu: 100m
              ephemeral-storage: 1Gi
        - name : liveness-prometheus
          resource:
            requests:
              memory: 64Mi
              cpu: 10m
              ephemeral-storage: 100Mi
            limits:
              memory: 256Mi
              cpu: 100m
              ephemeral-storage: 1Gi
      csiNFSProvisionerResource: |
        - name : csi-provisioner
          resource:
            requests:
              memory: 64Mi
              cpu: 10m
              ephemeral-storage: 100Mi
            limits:
              memory: 256Mi
              cpu: 100m
              ephemeral-storage: 1Gi
        - name : csi-nfsplugin
          resource:
            requests:
              memory: 64Mi
              cpu: 10m
              ephemeral-storage: 100Mi
            limits:
              memory: 1Gi
              cpu: 100m
              ephemeral-storage: 1Gi
        - name : csi-attacher
          resource:
            requests:
              memory: 64Mi
              cpu: 10m
              ephemeral-storage: 100Mi
            limits:
              memory: 1Gi
              cpu: 100m
              ephemeral-storage: 1Gi
      csiNFSPluginResource: |
        - name : driver-registrar
          resource:
            requests:
              memory: 64Mi
              cpu: 10m
              ephemeral-storage: 100Mi
            limits:
              memory: 256Mi
              cpu: 100m
              ephemeral-storage: 1Gi
        - name : csi-nfsplugin
          resource:
            requests:
              memory: 64Mi
              cpu: 10m
              ephemeral-storage: 100Mi
            limits:
              memory: 1Gi
              cpu: 100m
              ephemeral-storage: 1Gi
      nfs:
        enabled: true
      topology:
        enabled: false
        domainLabels: []
      cephFSAttachRequired: true
      rbdAttachRequired: true
      nfsAttachRequired: true

    enableDiscoveryDaemon: false
    useOperatorHostNetwork: false
    scaleDownOperator: false
    discover:
      toleration: NoSchedule
      tolerationKey: "node.kubernetes.io/arm64"
      tolerations:
        - key: "node.kubernetes.io/arm64"
          operator: "Exists"
          effect: "NoSchedule"
      nodeAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
          nodeSelectorTerms:
            - matchExpressions:
                - key: kubernetes.io/arch
                  operator: In
                  values:
                    - arm64
      podLabels: {}
      resources:
        limits:
          memory: 256Mi
          cpu: 100m
          ephemeral-storage: 1Gi
        requests:
          cpu: 5m
          memory: 64Mi
          ephemeral-storage: 100Mi

    hostpathRequiresPrivileged: false

    enforceHostNetwork: false

    disableDeviceHotplug: true

    revisionHistoryLimit: 2

    enableOBCWatchOperatorNamespace: true

    obcProvisionerNamePrefix: ""

    monitoring:
      enabled: true