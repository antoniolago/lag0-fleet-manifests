apiVersion: v1
kind: ConfigMap
metadata:
  name: headplane-config
  namespace: headscale
data:
  config.yaml: |
    # Server configuration
    server:
      host: 0.0.0.0
      port: 3000
      cookie_secure: true
      baseUrl: http://localhost:50443
      trustProxy: true
      cors:
        origin: http://localhost:50443
        credentials: true

    # Authentication settings
    auth:
      type: none  # Options: none, basic, oidc

    # Headscale integration
    headscale:
      url: http://localhost:50443
      config_path: /etc/headscale/config.yaml
      config_strict: true
      database:
        type: postgres
        host: headscale-postgresql
        port: 5432
        name: headscale
        user: headscale
        ssl: false
      dns:
        baseDomain: headscale.local
        magicDNS: true
        nameservers: 1.1.1.1,8.8.8.8
      derp:
        urls: []
        autoUpdate: true
        updateFrequency: 24h
      prefixes:
        v4: 100.64.0.0/10
        v6: fd7f:1194:f119:82dd::/64
      noise:
        privateKeyPath: /var/lib/headscale/noise_private.key
      privateKeyPath: /var/lib/headscale/private.key
      ephemeralNodeInactivityTimeout: 30m

    # Kubernetes integration
    integration:
      kubernetes:
        enabled: true
        validate_manifest: true
        pod_name: headscale-0
        namespace: headscale
        serviceAccount:
          create: true
          name: headscale
        rbac:
          create: true
          rules:
            - apiGroups: [""]
              resources: ["pods", "services"]
              verbs: ["get", "list", "watch"]

    # Database configuration
    database:
      type: postgres
      host: headscale-postgresql
      port: 5432
      database: headplane
      username: headscale
      ssl: false

    # Logging configuration
    logging:
      level: info
      format: json
      output: stdout

    # Feature flags
    features:
      enableMetrics: true
      enableHealthChecks: true
      enableSwagger: true
      enablePprof: false

    # Security settings
    security:
      rateLimit:
        enabled: true
        requests: 100
        window: 60 