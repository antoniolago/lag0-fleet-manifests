apiVersion: source.toolkit.fluxcd.io/v1
kind: HelmRepository
metadata:
  name: ejabberd
  namespace: movim-massacritica
spec:
  interval: 24h
  url: https://sando38.github.io/helm-ejabberd
---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: ejabberd
  namespace: movim-massacritica
spec:
  releaseName: ejabberd 
  targetNamespace: movim-massacritica
  install:
    createNamespace: true
  interval: 30m
  chart:
    spec:
      chart: ejabberd
      sourceRef:
        kind: HelmRepository
        name: ejabberd
        namespace: movim-massacritica
      interval: 12h
  values:
    hosts:
      - massacritica.lag0.com.br
    certFiles:
    secretName:
      - lag0-massacritica-certificate
    service:
      enabled: true
      single: true
      type: ClusterIP
    listen:
      https:
        enabled: false
        port: 5443
        # hostPort: 8000
        ## -- defaults to port, must correspond to ports defined in ejabberd.listen
        # containerPort: 8000
        expose: true
        exposedPort: 5443
        ## -- Different target ejabberd port on the cluster, useful for IP type LB
        # targetPort: 80
        # The port protocol (TCP/UDP)
        protocol: TCP
        # -- Use nodeport if set. This is useful if you have configured ejabberd in a
        # LoadBalancer.
        # nodePort: 30269
        # -- ejabberd listener options w/o port, transport:
        #    https://docs.ejabberd.im/admin/configuration/listen-options/
        options:
          ip: "::"
          module: ejabberd_http
          tls: true
          request_handlers: {}
            # /admin: ejabberd_web_admin
            # /api: mod_http_api
            # /bosh: mod_bosh
            # /captcha: ejabberd_captcha
            # /upload: mod_http_upload
            # /ws: ejabberd_http_ws