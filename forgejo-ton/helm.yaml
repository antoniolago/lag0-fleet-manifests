apiVersion: source.toolkit.fluxcd.io/v1beta2
kind: OCIRepository
metadata:
  name: forgejo
  namespace: forgejo
spec:
  interval: 12h
  url: oci://code.forgejo.org/forgejo-helm/forgejo
  ref:
    semver: "15.0.4"
---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: forgejo
  namespace: forgejo
spec:
  releaseName: forgejo-release
  targetNamespace: forgejo
  timeout: 20s
  install:
    createNamespace: true
  interval: 30m
  chartRef:
    kind: OCIRepository
    name: forgejo
  values:
    ingress:
      enabled: false
    service:
      http:
        type: ClusterIP
        port: 3000
    gitea:
      config:
        server: 
          ROOT_URL: "http://forgejo.lag0.com.br"
          SSH_DOMAIN: forgejo.lag0.com.br
          DOMAIN: forgejo.lag0.com.br
      ## @param gitea.admin.username Username for the Forgejo admin user
      ## @param gitea.admin.existingSecret Use an existing secret to store admin user credentials
      ## @param gitea.admin.password Password for the Forgejo admin user
      ## @param gitea.admin.email Email for the Forgejo admin user
      ## @param gitea.admin.passwordMode Mode for how to set/update the admin user password. Options are: initialOnlyNoReset, initialOnlyRequireReset, and keepUpdated
      admin:
        # existingSecret: gitea-admin-secret
        existingSecret: 'forgejo-admin-secret'
        email: 'forgejo@lag0.com.br'
        passwordMode: keepUpdated
    # gitea:
    #     oauth: 
    #       - name: 'Lag0Id'
    #         provider: 'Lag0Id'
    #         # key: 'Lag0Id'
    #         # secret: 'Lag0Id'
    #         existingSecret: 'forgejo-oauth'
    #         autoDiscoverUrl: 'https://id.lag0.com.br'
    #         useCustomUrls: false
    #         # customAuthUrl: 'https://id.lag0.com.br/oauth/authorize'
    #         # customTokenUrl: 'https://id.lag0.com.br/oauth/token'
    #         # customProfileUrl: 'https://id.lag0.com.br/api/v1/me'
    #         # customEmailUrl: 'https://id.lag0.com.br/api/v1/me/email'