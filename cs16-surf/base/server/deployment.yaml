
kind: Deployment
apiVersion: apps/v1
metadata:
  name: cs16-surf-deployment
  namespace: cs16-surf
spec:
  replicas: 1
  selector:
    matchLabels:
      app: cs16-surf
  template:
    metadata:
      name: cs16-surf
      namespace: cs16-surf
      labels:
        app: cs16-surf
    spec:
      nodeSelector:
        kubernetes.io/arch: arm64
        kubernetes.io/os: linux
      imagePullSecrets:
      - name: regcred
      containers:
      - name: cs16-surf-container
        image: placeholder #sonroyaalmerol/steamcmd-arm64:latest
        command:
        - /home/steamcmd/steamcmd.sh +force_install_dir /home/steamcmd/cs16 +login anonymous +app_update 90 +quit
        - /home/steamcmd/steamcmd.sh app_update 90 validate +quit
        - /usr/local/bin/box86 /home/steamcmd/cs16/hlds_linux  -game cstrike -console -insecure -nomaster +port 27020 +map de_dust2 +maxplayers 32 -pingboost 1
        # command: ["tail"]
        # args: ["-f", "/dev/null"]
        # ./steamcmd.sh +force_install_dir ./cs16 +login anonymous +app_update 90 +quit
        # /usr/local/bin/box86 ./hlds_run -console -game cstrike +port 27020 +map de_dust2 +maxplayers 32 -pingboost 1
        # ./steamcmd.sh app_update 90 validate
        # /usr/local/bin/box86 ./hlds_linux  -game cstrike -console -insecure -nomaster +port 27020 +map de_dust2 +maxplayers 32 -pingboost 1
        volumeMounts:
        - name: config-volume
          mountPath: /home/steamcmd/cs16/cstrike/config.cfg
          subPath: config.cfg
        resources:
          limits:
            cpu: "4"
            memory: 12Gi
          requests:
            cpu: 100m
            memory: 64Mi
        securityContext:
          allowPrivilegeEscalation: true
          privileged: true
      volumes:
      - name: config-volume
        configMap:
          name: game-config
          items:
          - key: config
            path: config.cfg
